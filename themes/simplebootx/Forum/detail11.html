<!DOCTYPE html>
<html lang="zh-cn">
<head>

<title>发布帖子|分享大一点的学生们的社团生活</title>
<tc_include file="Public:head"/>
    <style type="text/css">
        .pic-list li {
            margin-bottom: 5px;
        }
    </style>
    <script type="text/html" id="photos-item-wrapper">
        <li id="savedimage{id}">
            <input id="photo-{id}" type="hidden" name="photos_url[]" value="{filepath}">
            <input id="photo-{id}-name" type="text" name="photos_alt[]" value="{name}" style="width: 160px;" title="图片名称">
            <img id="photo-{id}-preview" src="{url}" style="height:36px;width: 36px;" onclick="parent.image_preview_dialog(this.src);">
            <a href="javascript:upload_one_image('图片上传','#photo-{id}');">替换</a>
            <a href="javascript:$('#savedimage{id}').remove();">移除</a>
        </li>
    </script>
</head>
<body class="container-fluid">
<tc_include file="Public:nav"/>
<div id="site-main" class="container-fluid">
    <div class="box-bgImg"></div>
    <div class="container">
        <nav class="meunPage">
            <h2 class="display-n">当前位置</h2>
            <ul>
                <li>首页</li>
                <li>></li>
                <li>论坛中心</li>
                <li>></li>
                <li>{$post.post_title}</li>
            </ul>
        </nav>
        <article class="forumPost-con container-fluid">
            <aside class="u-master">
                <a href="javascript:;" class="u-photo"><img src="images/08_avatar_middle.jpg" alt="" /></a>
                <address>
                    <p class="u-name">@黑钦王</p>
                    <p><a href="javascript:;">加为好友</a> <a href="javascript:;">给我留言</a><br /><a href="javascript:;">我的主页</a> <a href="javascript:;">个人相册</a></p>
                    <hr />
                    <p>
                        <span>身份</span>：<a href="javascript:;">学生</a>/<a href="javascript:;">普通会员</a><br />
                        <span>年级</span>：2014级 <br />
                        <span>学院</span>：信息工程学院 <br />
                        <span>专业</span>：计算机网络技术
                    </p>
                </address>
            </aside>
            <section class="con pr0 clearfix">
                <header>
                    <h3><a href="javascript:;">[学习]</a> <a href="javascript:;">{$post.post_title}</a></h3>
                    <p>浏览：{$post.post_hits} | 评论：{$post.comment_count} | 发表于 <time datetime="{$post.post_date}">{$post
                        .post_date}</time>
                        <strong
                                class="fr reply-num">楼主</strong></p>
                </header>
                <div class="master-con">
                    {$post.post_content}
                    <php>
                        $arr = json_decode($post['smeta'],true);
                        $arr1 = $arr['thumb'];
                        $arr2 = $arr['photo'];
                    </php>
                    <foreach name="arr1" item="img">
                        <img src="./data/upload/{$img}" alt=""/>

                    </foreach>


                    <foreach name="arr2" item="img2">
                        <img src="./data/upload/{$img2.url}" align="{$img2.alt}"/>
                    </foreach>


                </div>
                <ul class="reply-btn">
                    <li><a href="javascript:;">回复</a></li>
                </ul>
            </section>
        </article>

        <article class="forumPost-con container-fluid">
            <aside class="u-master">
                <a href="javascript:;" class="u-photo"><img src="images/08_avatar_middle.jpg" alt="" /></a>
                <address>
                    <p class="u-name">@黑钦王</p>
                    <p><a href="javascript:;">加为好友</a> <a href="javascript:;">给我留言</a><br /><a href="javascript:;">我的主页</a> <a href="javascript:;">个人相册</a></p>
                    <hr />
                    <p>
                        <span>身份</span>：<a href="javascript:;">学生</a>/<a href="javascript:;">普通会员</a><br />
                        <span>年级</span>：2014级 <br />
                        <span>学院</span>：信息工程学院 <br />
                        <span>专业</span>：计算机网络技术
                    </p>
                </address>
            </aside>
            <section class="con pr0">
                <header>
                    <p>发表于 <time datetime="2016-8-23 14:29:24">2016-8-23 14:29:24</time> <strong class="fr reply-num">1#</strong></p>
                </header>
                <div class="master-con">
                    错了三处也无所谓，反正语文老师退休了，也没人给你批改作业了！网民放长假啦！
                    <ul class="reply-btn">
                        <li><a href="javascript:;">回复</a></li>
                    </ul>
                    <section class="reply-box container-fluid">
                        <h4 id="reply-hd">收起回复 -</h4>
                        <div class="reply-con">
                            <article class="item clearfix">
                                <header class="container-fluid pr">
                                    <h4 class="mt0"><a href="javascript:;" class="u-photo"><img src="images/08_avatar_middle.jpg" alt="" /></a> <a href="javascript:;" class="u-name">黑钦王</a></h4>
                                    <time datetime="2016-10-25 01:20" class="fr post-tiem" style="color: #909090">2016-10-25 01:20</time>
                                </header>
                                <div>
                                    尝试下回复的内容试试看！
                                </div>
                                <ul class="reply-btn ">
                                    <li><a href="javascript:;">回复</a></li>
                                </ul>
                            </article>
                            <article class="item clearfix">
                                <header class="container-fluid pr">
                                    <h4 class="mt0"><a href="javascript:;" class="u-photo"><img src="images/08_avatar_middle.jpg" alt="" /></a> <a href="javascript:;" class="u-name">Bigyang</a></h4>
                                    <time datetime="2016-10-25 01:20" class="fr post-tiem" style="color: #909090">2016-10-25 01:20</time>
                                </header>
                                <blockquote class="source"><a href="javascript:;">黑钦王</a>：尝试下回复的内容试试看！</blockquote>
                                <div>
                                    回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容回复的内容
                                </div>
                                <ul class="reply-btn ">
                                    <li><a href="javascript:;">回复</a></li>
                                </ul>
                            </article>
                        </div>
                    </section>
                </div>
            </section>
        </article>
        <footer class="con-footer">
            <nav class="textalignC">
                <ul class="pagination">
                    <li class="prev"><a href="javascript:;">&laquo;</a></li>
                    <li class="active"><a href="javascript:;">1</a></li>
                    <li><a href="javascript:;">2</a></li>
                    <li><a href="javascript:;">3</a></li>
                    <li><a href="javascript:;">4</a></li>
                    <li><a href="javascript:;">5</a></li>
                    <li class="disabled"><span>...</span></li>
                    <li><a href="javascript:;">48</a></li>
                    <li class="next"><a href="javascript:;">&raquo;</a></li>
                </ul>
            </nav>
        </footer>
        </volist>
                <form action="{:U('Index/add_post')}" method="post" class="form-horizontal"
                      enctype="multipart/form-data">
                    <div class="row-fluid">
                        <div class="span99">
                            <table class="table table-bordered">

                                <tr>
                                    <th>内容</th>
                                    <td>
                                        <script type="text/plain" id="content" name="post[post_content]"></script>
                                    </td>
                                </tr>
                                <tr>
                                    <th>相册图集</th>
                                    <td>
                                        <ul id="photos" class="pic-list unstyled"></ul>
                                        <a href="javascript:upload_multi_image('图片上传','#photos','photos-item-wrapper');" class="btn btn-small">选择图片</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="hidden" name="post[post_date]"
                                               value="{:date('Y-m-d H:i:s',time())}" class="js-datetime" style="width: 160px;"></td>
                                </tr>
                            </table>
                        </div>

                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary js-ajax-submit" type="submit">提交</button>
                        <a class="btn" href="javascript:history.back(-1);">返回</a>
                    </div>
                </form>
            </div>
    <script type="text/javascript" src="__PUBLIC__/js/common.js"></script>
    <script type="text/javascript">
        //编辑器路径定义
        var editorURL = GV.WEB_ROOT;
    </script>
    <script type="text/javascript" src="__PUBLIC__/js/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/ueditor/ueditor.all.min.js"></script>
    <script type="text/javascript">
        $(function() {
            $(".js-ajax-close-btn").on('click', function(e) {
                e.preventDefault();
                Wind.use("artDialog", function() {
                    art.dialog({
                        id : "question",
                        icon : "question",
                        fixed : true,
                        lock : true,
                        background : "#CCCCCC",
                        opacity : 0,
                        content : "您确定需要关闭当前页面嘛？",
                        ok : function() {
                            setCookie("refersh_time", 1);
                            window.close();
                            return true;
                        }
                    });
                });
            });
            /////---------------------
            Wind.use('validate', 'ajaxForm', 'artDialog', function() {
                //javascript

                //编辑器
                editorcontent = new baidu.editor.ui.Editor();
                editorcontent.render('content');
                try {
                    editorcontent.sync();
                } catch (err) {
                }
                //增加编辑器验证规则
                jQuery.validator.addMethod('editorcontent', function() {
                    try {
                        editorcontent.sync();
                    } catch (err) {
                    }
                    return editorcontent.hasContents();
                });
                var form = $('form.js-ajax-forms');
                //ie处理placeholder提交问题
                if ($.browser && $.browser.msie) {
                    form.find('[placeholder]').each(function() {
                        var input = $(this);
                        if (input.val() == input.attr('placeholder')) {
                            input.val('');
                        }
                    });
                }

                var formloading = false;
                //表单验证开始
                form.validate({
                    //是否在获取焦点时验证
                    onfocusout : false,
                    //是否在敲击键盘时验证
                    onkeyup : false,
                    //当鼠标掉级时验证
                    onclick : false,
                    //验证错误
                    showErrors : function(errorMap, errorArr) {
                        //errorMap {'name':'错误信息'}
                        //errorArr [{'message':'错误信息',element:({})}]
                        try {
                            $(errorArr[0].element).focus();
                            art.dialog({
                                id : 'error',
                                icon : 'error',
                                lock : true,
                                fixed : true,
                                background : "#CCCCCC",
                                opacity : 0,
                                content : errorArr[0].message,
                                cancelVal : '确定',
                                cancel : function() {
                                    $(errorArr[0].element).focus();
                                }
                            });
                        } catch (err) {
                        }
                    },
                    //验证规则
                    rules : {
                        'post[post_title]' : {
                            required : 1
                        },
                        'post[post_content]' : {
                            editorcontent : true
                        }
                    },
                    //验证未通过提示消息
                    messages : {
                        'post[post_title]' : {
                            required : '请输入标题'
                        },
                        'post[post_content]' : {
                            editorcontent : '内容不能为空'
                        }
                    },
                    //给未通过验证的元素加效果,闪烁等
                    highlight : false,
                    //是否在获取焦点时验证
                    onfocusout : false,
                    //验证通过，提交表单
                    submitHandler : function(forms) {
                        if (formloading)
                            return;
                        $(forms).ajaxSubmit({
                            url : form.attr('action'), //按钮上是否自定义提交地址(多按钮情况)
                            dataType : 'json',
                            beforeSubmit : function(arr, $form, options) {
                                formloading = true;
                            },
                            success : function(data, statusText, xhr, $form) {
                                formloading = false;
                                if (data.status) {
                                    setCookie("refersh_time", 1);
                                    //添加成功
                                    Wind.use("artDialog", function() {
                                        art.dialog({
                                            id : "succeed",
                                            icon : "succeed",
                                            fixed : true,
                                            lock : true,
                                            background : "#CCCCCC",
                                            opacity : 0,
                                            content : data.info,
                                            button : [ {
                                                name : '继续添加？',
                                                callback : function() {
                                                    reloadPage(window);
                                                    return true;
                                                },
                                                focus : true
                                            }, {
                                                name : '返回列表页',
                                                callback : function() {
                                                    location = "{:U('AdminPost/index')}";
                                                    return true;
                                                }
                                            } ]
                                        });
                                    });
                                } else {
                                    artdialog_alert(data.info);
                                }
                            }
                        });
                    }
                });
            });
            ////-------------------------
        });
    </script>
            </div>
        </section>
    </div>
    <div class="container-fluid fooetrBg"></div>
</div>
<tc_include file="Public:footer"/>

</body>
</html>