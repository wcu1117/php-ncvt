<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>用户中心|分享大一点的学生们的社团生活</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="__TMPL__public/bootstrap-3.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="__TMPL__public/css/style.css">
    <link rel="stylesheet" href="__TMPL__public/css/user.css">
    <link href="__TMPL__Public/assets/simpleboot/font-awesome/4.4.0/css/font-awesome.min.css"  rel="stylesheet" type="text/css">

    <style type="text/css">
        .main{
            margin: 0 auto;
            padding: 15px;
            width: 750px;
            font-family: "microsoft yahei";
            background-color: #F5F5F5;
        }
        .cf:before,.cf:after {
            display: table;
            content: "";
            line-height: 0;
        }
        .cf:after {
            clear: both;
        }
        .cf {
            *zoom: 1;
            margin-left: 30%;
        }
        .upload-area {
            position: relative;
            float: left;
            margin-right: 30px;
            /*margin-left:200px;*/
            width: 200px;
            height: 200px;
            background-color: #F5F5F5;
            border: 2px solid #E1E1E1;
        }
        .upload-area .file-tips {
            position: absolute;
            top: 90px;
            left: 0;
            padding: 0 15px;
            width: 170px;
            line-height: 1.4;
            font-size: 12px;
            color: #A8A8A3;
            text-align: center;
        }
        .userup-icon {
            display: inline-block;
            margin-right: 3px;
            width: 16px;
            height: 16px;
            vertical-align: -2px;
            background: url("__TMPL__public/images/userup_icon.png") no-repeat;
        }
        .uploadify-button {
            line-height: 120px!important;
            text-align: center;
        }
        .preview-area {
            float: left;
        }
        .tcrop {
            clear: right;
            font-size: 14px;
            font-weight: bold;
        }
        .update-pic .crop {
            background: url("__TMPL__public/images/mystery.png") no-repeat scroll center center #EEEEEE;
            float: left;
            margin-bottom: 20px;
            margin-top: 10px;
            overflow: hidden;
        }
        .crop100 {
            height: 100px;
            width: 100px;
        }
        .crop60 {
            height: 60px;
            margin-left: 20px;
            width: 60px;
        }
        .update-pic .save-pic {
            clear: left;
            margin-right: 20px;
        }
        .update-pic .uppic-btn {
            background-color: #348FD4;
            color: #FFFFFF;
            display: block;
            float: left;
            font-size: 16px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            vertical-align: middle;
            width: 89px;
        }
        .preview {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 11;
            width: 200px;
            height: 200px;
            overflow: hidden;
            background:#fff;
            display: none;
        }
    </style>

    <link rel="stylesheet" type="text/css" href="__TMPL__public/css/jquery.Jcrop.min.css" media="all">
    <link rel="stylesheet" type="text/css" href="__TMPL__public/js/uploadify-v3.1/uploadify.css" media="all">
    <script type="text/javascript" src="__TMPL__public/js/jquery-1.7.2.min.js"></script>
    <link rel="stylesheet" type="text/css" href="__TMPL__public/js/ThinkBox/css/ThinkBox.css" media="all">



</head>
<body class="container-fluid">
<tc_include file="Public:nav"/>
<div id="site-main" class="container-fluid">
    <div class="box-bgImg"></div>
    <div class="container">
        <nav class="meunPage">
            <h2 class="display-n">当前位置</h2>
            <ul>
                <li>首页</li>
                <li>></li>
                <li>我的个人中心</li>
            </ul>
        </nav>
        <section class="user-con container-fluid">
        <tc_include file="User:menu"/>
            <section class="u-main col-md-10">
                <nav>
                    <ul class="infoBox-nav nav nav-tabs textalignL" role="tablist">
                        <li role="presentation" class="active"><a href="javascript:void(0);">基本资料</a></li>
                        <li role="presentation"><a href="{:U('login/password')}">密码修改</a></li>
                    </ul>
                </nav>
                <article class="u-setInfo get-sectionBox">
                    <header>
                        <h4 class="hidden">基本资料</h4>
                        <nav class="u-nav">
                            <ul id="setInfo-nav" class=" nav nav-pills textalignC" role="tablist">
                              <li role="presentation" class="active"><a href="javascript:void(0);">基本信息</a></li>
                              <li role="presentation"><a href="javascript:void(0);">修改信息</a></li>
                              <li role="presentation"><a href="javascript:void(0);">用户头像</a></li>
                              <li role="presentation"><a href="javascript:void(0);">教育经历</a></li>
                              <li role="presentation"><a href="javascript:void(0);">联系方式</a></li>
                            </ul>
                        </nav>
                    </header>
                    <hr />
                    <!--用户信息-->
                    <section class="u-infoAdd">
                        <h5 class="hidden">基本信息</h5>
                        <div class="con table-responsive">
                            <table class="table">
                                <tr class="u-setNmae">
                                    <td>昵称：</td>
                                    <td>
                                        <span>{$user.user_nicename}</span>
                                        <input type="text" name="u-setName" value="黑钦王" class="u-EditorName hidden form-control" />

                                    </td>
                                </tr>
                                <tr class="u-studentId">
                                    <td>学号：</td>
                                    <td>
                                        <span>{$user.school_id}</span>
                                    </td>
                                </tr>
                                <tr class="u-setNmae">
                                    <td>邮箱：</td>
                                    <td>
                                        <span>{$user.user_email}</span>
                                        <input type="text" name="u-setName" value="黑钦王" class="u-EditorName hidden form-control" />

                                    </td>
                                </tr>
                                <tr class="u-realname">
                                    <td>真实姓名：</td>
                                    <td>
                                        <span>{$user.user_name}</span>
                                    </td>                                </tr>
                                <tr class="u-sex">
                                    <td>性别：</td>
                                    <td>
                                        <span><if condition="$user.sex eq 1">男<else/>女</if></span>
                                    </td>                                </tr>
                                <tr class="u-birth">
                                    <td>生日：</td>
                                    <td>
                                        <span>{$user.birthday}</span>
                                    </td>                                </tr>
                                <tr>
                                    <td>星座：</td>
                                    <td>
                                        <span>{$user.constellation}</span>
                                    </td>                                </tr>
                                <tr>
                                    <td class="v-alignTop">签名介绍：</td>
                                    <td>
                                        <span>{$user.signature}</span>
                                    </td>                                </tr>

                            </table>
                        </div>
                    </section>
                    <!--编辑信息-->
                    <section class="u-infoAdd hidden">
                        <h5 class="hidden">编辑信息</h5>
                        <div class="con table-responsive">
                            <form id="form1" method="post">
                                <table class="table">
                                    <tr class="u-setNmae">
                                        <td>昵称：</td>
                                        <td>
                                            <input type="text" id="nicename" name="user_nicename"
                                                   value="{$user.user_nicename}"
                                                   class="form-control" disabled/><span>*</span>

                                        </td>
                                    </tr>
                                    <tr class="u-studentId">
                                        <td>学号：</td>
                                        <td>
                                            <input type="text" name="school_id" class="form-control" value="<notempty
                                                name="user.school_id">{$user.school_id}</notempty>"/><span>*</span></td>
                                    </tr>
                                    <tr class="u-realname">
                                        <td>真实姓名：</td>
                                        <td><input type="text" name="user_name" class="form-control" value="<notempty
                                                name="user.user_name">{$user.user_name}</notempty>"/></td>
                                    </tr>
                                    <tr class="u-sex">
                                        <td>性别：</td>
                                        <td>

                                            <label><input type="radio" name="sex" value="1"  <if
                                                    condition="$user.sex eq 1">checked</if>  /> 男</label>

                                            <label><input type="radio" name="sex" value="0" <if
                                                    condition="$user.sex eq 0">checked</if>/> 女</label>

                                        </td>
                                    </tr>
                                    <tr class="u-birth">
                                        <td>生日：</td>
                                        <td>
                                            <select  class="u-birthYear form-control" name="year">
                                                <option><notempty
                                                        name="user.birthday"><?php echo date('Y',strtotime($user['birthday']));?><else/>
                                                    请选择</option></notempty>
                                                <option>2016</option>
                                                <option>2015</option>
                                                <option>2014</option>
                                                <option>2013</option>
                                                <option>2012</option>
                                                <option>2011</option>
                                                <option>2010</option>
                                                <option>2009</option>
                                                <option>2008</option>
                                                <option>2007</option>
                                                <option>2006</option>
                                                <option>2005</option>
                                                <option>2004</option>
                                                <option>2003</option>
                                                <option>2002</option>
                                                <option>2001</option>
                                                <option>2000</option>
                                                <option>1999</option>
                                                <option>1998</option>
                                                <option>1997</option>
                                                <option>1996</option>
                                                <option>1995</option>
                                                <option>1994</option>
                                                <option>1993</option>
                                                <option>1992</option>
                                                <option>1991</option>
                                                <option>1990</option>
                                                <option>1989</option>
                                                <option>1988</option>
                                            </select>
                                            <span>年 -</span>
                                            <select  class="u-birthMonth form-control" name="month">
                                                <option><notempty
                                                        name="user.birthday"><?php echo date('m',strtotime($user['birthday']));?><else/>
                                                    请选择</notempty></option>
                                                <option>1</option>
                                                <option>2</option>
                                                <option>3</option>
                                                <option>4</option>
                                                <option>5</option>
                                                <option>6</option>
                                                <option>7</option>
                                                <option>8</option>
                                                <option>9</option>
                                                <option>10</option>
                                                <option>11</option>
                                                <option>12</option>
                                            </select>
                                            <span>月 -</span>
                                            <select  class="u-birthDay form-control" name="day">
                                                <option><notempty
                                                        name="user.birthday"><?php echo date('d',strtotime($user['birthday']));?><else/>
                                                    请选择</notempty></option>
                                                <option>1</option>
                                                <option>2</option>
                                                <option>3</option>
                                                <option>4</option>
                                                <option>5</option>
                                                <option>6</option>
                                                <option>7</option>
                                                <option>8</option>
                                                <option>9</option>
                                                <option>10</option>
                                                <option>11</option>
                                                <option>12</option>
                                                <option>13</option>
                                                <option>14</option>
                                                <option>15</option>
                                                <option>16</option>
                                                <option>17</option>
                                                <option>18</option>
                                                <option>19</option>
                                                <option>20</option>
                                                <option>21</option>
                                                <option>22</option>
                                                <option>23</option>
                                                <option>24</option>
                                                <option>25</option>
                                                <option>26</option>
                                                <option>27</option>
                                                <option>28</option>
                                                <option>29</option>
                                                <option>30</option>
                                                <option>31</option>
                                            </select>
                                            <span>日</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>星座：</td>
                                        <td>
                                            <select name="constellation" class="form-control">
                                                <option>白羊</option>
                                                <option>金牛</option>
                                                <option>天蝎</option>
                                                <option>狮子</option>
                                            </select>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="v-alignTop">签名/介绍：</td>
                                        <td><textarea name="signature" id="u-introduce" style="width: 60%; height: 90px;" class="form-control"><notempty
                                                name="user.signature">{$user.signature}</notempty></textarea></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td>
                                            <label class="btn-group dropup"><input id="btn1" type="button"
                                                                                   name="submit-btn"
                                                                                   value="保存" class="btn btn-default js-ajax-submit" /></label>
                                            <label class="btn-group dropup"><input type="reset" name="reset-btn" value="重置" class="btn btn-default" /></label>
                                        </td>
                                    </tr>
                                </table>
                            </form>
                        </div>
                    </section>
                    <!--上传头像-->
                    <section class="u-educationAdd hidden">
                        <h5 class="hidden">上传头像</h5>
                        <!-- 修改头像 -->
                        <form method="post" id="pic" class="update-pic cf">
                            <div class="upload-area">
                                <input type="file" id="user-pic">
                                <div class="file-tips">支持JPG,PNG,GIF，图片小于1MB，尺寸不小于100*100,真实高清头像更受欢迎！</div>
                                <div class="preview hidden" id="preview-hidden"></div>
                            </div>
                            <div class="preview-area">
                                <input type="hidden" id="x" name="x" />
                                <input type="hidden" id="y" name="y" />
                                <input type="hidden" id="w" name="w" />
                                <input type="hidden" id="h" name="h" />
                                <input type="hidden" id='img_src' name='src'/>
                                <div class="tcrop">头像预览</div>
                                <div class="crop crop100"><img id="crop-preview-100" src="" alt=""></div>
                                <div class="crop crop60"><img id="crop-preview-60" src="" alt=""></div>
                                <a class="uppic-btn save-pic" href="javascript:;">保存</a>
                                <a class="uppic-btn reupload-img" href="javascript:$('#user-pic').uploadify('cancel','*');">重新上传</a>
                            </div>
                        </form>
                        <!-- /修改头像 -->

                    </section>
                    <!--教育信息-->
                    <section class="u-educationAdd hidden">
                        <h5 class="hidden">教育经历</h5>
                        <div class="con table-responsive">
                            <form id="form3" method="post">
                            <table class="table  js-ajax-form">
                                <tr>
                                    <td>毕业学校：</td>
                                    <td><input type="text" name="shcool" value="南宁职业技术学院" disabled class="form-control" /></td>
                                </tr>
                                <tr>
                                    <td>入学年份：</td>
                                    <td>
                                        <select name="enter" class="form-control">
                                            <option>请选择</option>
                                            <option>2017</option>
                                            <option>2016</option>
                                            <option>2015</option>
                                            <option>2014</option>
                                            <option>2013</option>
                                            <option>2012</option>
                                            <option>2011</option>
                                        </select>
                                        <span>年</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>学历：</td>
                                    <td>
                                        <select name="level" class="form-control" disabled >
                                            <option checked >大专</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>专业：</td>
                                    <td>
                                        <select name="college" class="form-control">
                                            <option>请选择</option>
                                            <option>艺术工程学院</option>
                                            <option>信息工程学院</option>
                                            <option>建筑工程学院</option>
                                            <option>国际贸易学院</option>
                                            <option>财经学院</option>
                                            <option>商学院</option>
                                            <option>旅游学院</option>
                                        </select>
                                        <span>学院/系 -</span>
                                        <select name="major" class="form-control">
                                            <option>请选择</option>
                                            <option>计算机网络</option>
                                            <option>软件开发</option>
                                            <option>物联网</option>
                                            <option>信息管理</option>
                                            <option>计算机应用</option>
                                        </select>
                                        <span>专业</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td>
                                        <label class="btn-group dropup"><input id="btn3" type="button" name="submit-btn"
                                                                               value="保存" class="btn btn-default js-ajax-submit" /></label>
                                        <label class="btn-group dropup"><input type="reset" name="reset-btn" value="重置" class="btn btn-default" /></label>
                                    </td>
                                </tr>
                            </table>
                            </form>
                        </div>
                    </section>
                    <!--联系方式-->
                    <section class="u-contactAdd hidden">
                        <h5 class="hidden">联系方式</h5>
                        <div class="con table-responsive">
                            <form id="form4" method="post">
                            <table class="table  js-ajax-form">

                                    <tr>
                                        <td>手机号码：</td>
                                        <td><input type="text" name="number" class="form-control"
                                                   value="{$con.number}"/></td>
                                    </tr>
                                    <tr>
                                        <td>新浪微博：</td>
                                        <td><input type="text" name="weibo" class="form-control"
                                                   value="{$con.weibo}"/></td>
                                    </tr>
                                    <tr>
                                        <td>Email：</td>
                                        <td><input type="text" name="email" class="form-control"
                                                   value="{$con.email}"/></td>
                                    </tr>
                                    <tr>
                                        <td>Q Q：</td>
                                        <td><input type="text" name="qq" class="form-control" value="{$con.qq}"/></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td>
                                            <label class="btn-group dropup"><input id="btn4" type="button"
                                                                                   name="submit-btn"
                                                                                   value="确定保存" class="btn btn-default js-ajax-submit" /></label>
                                        </td>
                                    </tr>
                                </table>
                            </form>
                        </div>
                    </section>
                </article>
            </section>
        </section>
    </div>
    <div class="container-fluid fooetrBg"></div>
</div>
<tc_include file="Public:footer"/>

<!--<script src="__TMPL__public/js/jquery-1.11.1.min.js"></script>-->

<script>
    $(function(){
        //用户中心选项卡
        var u_navTag_btn = $('.u-nav>ul').children('li');
        var sectionBox = $('.get-sectionBox').children('section');
        for (var i = 0; i < u_navTag_btn.length; i++) {
            u_navTag_btn[i].index = i;
            u_navTag_btn[i].onclick = function(){
                for (var i = 0; i < u_navTag_btn.length; i++) {
                    u_navTag_btn[i].className = "";
                    $(sectionBox[i]).addClass("hidden");
                }
                this.className = "active";
                $(sectionBox[this.index]).removeClass("hidden");
            }
        }
        //修改昵称
        var oldUserName = $('.u-infoAdd .u-setNmae>td>span');
        var newUserName = $('.u-EditorName');
        $('#setName-btn').click(function(){
            if(oldUserName.is(':visible') == true){
                oldUserName.addClass('hidden');
                newUserName.removeClass('hidden');
            }else{
                oldUserName.removeClass('hidden');
                newUserName.addClass('hidden');
                oldUserName.text(newUserName.val());
            }
        });


    })
</script>

<!-- ajax -->
<!--<script src="__PUBLIC__/js/jquery.js"></script>-->
<script src="__PUBLIC__/js/noty/noty.js"></script>

<script type="text/javascript">
    $(function(){
        //修改信息
        $('#btn1').click(function () {
            $("#nicename").attr('disabled',false);
            var url = "{:U('index/edit_post')}";//发送URL
            var data = $('#form1').serialize();    //序列化表单数据
            $.post(url,data,
                    function(data){
                        console.log(data);
                        alert(data.info);
                        if(data.status==1){
                            noty({
                                text:data.info,
                                type:'success',
                                layout:'center',
                                callback:{
                                    onClose:function(){
                                        if (data.referer) {
                                            location.href = data.referer;
                                            return;
                                        }

                                        if(refresh || refresh==undefined){
                                            reloadPage(window);
                                        }
                                    }
                                }
                            });

                        }else{
                            noty({text: data.info,
                                type:'error',
                                layout:'center',
                                callback:{
                                    onClose:function(){
                                        if (data.referer) {
                                            location.href = data.referer;
                                        }
                                    }
                                }
                            });

                        }
                    })

        });
        //教育信息
        $('#btn3').click(function () {
            var url = "{:U('Index/edu_post')}";//发送URL
            var data = $('#form3').serialize();    //序列化表单数据

            $.post(url,data,
//					{
//						username: encodeURI($('#input_username').val()),//获取值
//						password: encodeURI($('#input_password').val()),
//						verify : encodeURI($('#input_verify').val())
//					},
                    function(data){
                        console.log(data);
                        //alert(data.info);
                        if(data.status==1){
                            noty({
                                text:data.info,
                                type:'success',
                                layout:'center',
                                callback:{
                                    onClose:function(){
                                        if (data.referer) {
                                            location.href = data.referer;
                                            return;
                                        }

                                        if(refresh || refresh==undefined){
                                            reloadPage(window);
                                        }
                                    }
                                }
                            });

                        }else{
                            noty({text: data.info,
                                type:'error',
                                layout:'center',
                                callback:{
                                    onClose:function(){
                                        if (data.referer) {
                                            location.href = data.referer;
                                        }
                                    }
                                }
                            });

                        }
                    })

        });
        //联系信息
        $('#btn4').click(function () {
            var url = "{:U('Index/con_post')}";//发送URL
            var data = $('#form4').serialize();    //序列化表单数据

            $.post(url,data,
//					{
//						username: encodeURI($('#input_username').val()),//获取值
//						password: encodeURI($('#input_password').val()),
//						verify : encodeURI($('#input_verify').val())
//					},
                    function(data){
                        console.log(data);
                        //alert(data.info);
                        if(data.status==1){
                            noty({
                                text:data.info,
                                type:'success',
                                layout:'center',
                                callback:{
                                    onClose:function(){
                                        if (data.referer) {
                                            location.href = data.referer;
                                            return;
                                        }

                                        if(refresh || refresh==undefined){
                                            reloadPage(window);
                                        }
                                    }
                                }
                            });

                        }else{
                            noty({text: data.info,
                                type:'error',
                                layout:'center',
                                callback:{
                                    onClose:function(){
                                        if (data.referer) {
                                            location.href = data.referer;
                                        }
                                    }
                                }
                            });

                        }
                    })

        })
    })
</script>

<script type="text/javascript" src="__TMPL__public/js/uploadify-v3.1/jquery.uploadify-3.1.min.js"></script>
<script type="text/javascript" src="__TMPL__public/js/jquery.Jcrop.min.js"></script>
<script type="text/javascript" src="__TMPL__public/js/ThinkBox/jquery.ThinkBox.js"></script>

<script type="text/javascript">
    $(function(){
        //上传头像(uploadify插件)
        $("#user-pic").uploadify({
            'queueSizeLimit' : 1,
            'removeTimeout' : 0.5,
            'preventCaching' : true,
            'multi'    : false,
            'swf' 			: '/cmf/themes/simplebootx/public/js/uploadify-v3.1/uploadify.swf',
            'uploader' 		: '{:U("Index/uploadImg")}',
            'buttonText' 	: '<i class="userup-icon"></i>上传头像',
            'width' 		: '200',
            'height' 		: '200',
            'fileTypeExts'	: '*.jpg; *.png; *.gif;',
            'onUploadSuccess' : function(file, data, response){
                //调试语句
                console.log(data);

                var data = $.parseJSON(data);
                if(data['status'] == 0){    //如果上传失败
                    $.ThinkBox.error(data['info'],{'delayClose':3000});
                    return;
                }
                var preview = $('.upload-area').children('#preview-hidden');
                preview.show().removeClass('hidden');
                //两个预览窗口赋值
                $('.crop').children('img').attr('src',data['path']+'?random='+Math.random());
                //隐藏表单赋值
                $('#img_src').val(data['path']);
                //绑定需要裁剪的图片
                var img = $('<img />');
                preview.append(img);
                preview.children('img').attr('src',data['path']+'?random='+Math.random());
                var crop_img = preview.children('img');
                crop_img.attr('id',"cropbox").show();
                var img = new Image();
                img.src = data['path']+'?random='+Math.random();
                //根据图片大小在画布里居中
                img.onload = function(){
                    var img_height = 0;
                    var img_width = 0;
                    var real_height = img.height;
                    var real_width = img.width;
                    if(real_height > real_width && real_height > 200){
                        var persent = real_height / 200;
                        real_height = 200;
                        real_width = real_width / persent;
                    }else if(real_width > real_height && real_width > 200){
                        var persent = real_width / 200;
                        real_width = 200;
                        real_height = real_height / persent;
                    }
                    if(real_height < 200){
                        img_height = (200 - real_height)/2;
                    }
                    if(real_width < 200){
                        img_width = (200 - real_width)/2;
                    }
                    preview.css({width:(200-img_width)+'px',height:(200-img_height)+'px'});
                    preview.css({paddingTop:img_height+'px',paddingLeft:img_width+'px'});
                }
                //裁剪插件
                $('#cropbox').Jcrop({
                    bgColor:'#333',   //选区背景色
                    bgFade:true,      //选区背景渐显
                    fadeTime:1000,    //背景渐显时间
                    allowSelect:false, //是否可以选区，
                    allowResize:true, //是否可以调整选区大小
                    aspectRatio: 1,     //约束比例
                    minSize : [100,100],//可选最小大小
                    boxWidth : 200,		//画布宽度
                    boxHeight : 200,	//画布高度
                    onChange: showPreview,//改变时重置预览图
                    onSelect: showPreview,//选择时重置预览图
                    setSelect:[ 0, 0, 100, 100],//初始化时位置
                    onSelect: function (c){	//选择时动态赋值，该值是最终传给程序的参数！
                        $('#x').val(c.x);//需裁剪的左上角X轴坐标
                        $('#y').val(c.y);//需裁剪的左上角Y轴坐标
                        $('#w').val(c.w);//需裁剪的宽度
                        $('#h').val(c.h);//需裁剪的高度
                    }
                });
                //提交裁剪好的图片
                $('.save-pic').click(function(){
                    if($('#preview-hidden').html() == ''){
                        $.ThinkBox.error('请先上传图片！');
                    }else{
                        //由于GD库裁剪gif图片很慢，所以长时间显示弹出框
                        $.ThinkBox.success('图片处理中，请稍候……',{'delayClose':30000});




                            var url = "{:U('Index/cropImg')}";//发送URL
                            var data = $('#pic').serialize();    //序列化表单数据

                            $.post(url,data,
                                    function(data){
                                        console.log(data);
                                        //alert(data.info);
                                        if(data.status==1){
                                            noty({
                                                text:data.info,
                                                type:'success',
                                                layout:'center',
                                                callback:{
                                                    onClose:function(){
                                                        if (data.referer) {
                                                            location.href = data.referer;
                                                            return;
                                                        }

                                                        if(refresh || refresh==undefined){
                                                            reloadPage(window);
                                                        }
                                                    }
                                                }
                                            });

                                        }else{
                                            noty({text: data.info,
                                                type:'error',
                                                layout:'center',
                                                callback:{
                                                    onClose:function(){
                                                        if (data.referer) {
                                                            location.href = data.referer;
                                                        }
                                                    }
                                                }
                                            });

                                        }
                                    })


                    }
                });
                //重新上传,清空裁剪参数
                var i = 0;
                $('.reupload-img').click(function(){
                    $('#preview-hidden').find('*').remove();
                    $('#preview-hidden').hide().addClass('hidden').css({'padding-top':0,'padding-left':0});
                });
            }
        });
        //预览图
        function showPreview(coords){
            var img_width = $('#cropbox').width();
            var img_height = $('#cropbox').height();
            //根据包裹的容器宽高,设置被除数
            var rx = 100 / coords.w;
            var ry = 100 / coords.h;
            $('#crop-preview-100').css({
                width: Math.round(rx * img_width) + 'px',
                height: Math.round(ry * img_height) + 'px',
                marginLeft: '-' + Math.round(rx * coords.x) + 'px',
                marginTop: '-' + Math.round(ry * coords.y) + 'px'
            });
            rx = 60 / coords.w;
            ry = 60 / coords.h;
            $('#crop-preview-60').css({
                width: Math.round(rx * img_width) + 'px',
                height: Math.round(ry * img_height) + 'px',
                marginLeft: '-' + Math.round(rx * coords.x) + 'px',
                marginTop: '-' + Math.round(ry * coords.y) + 'px'
            });
        }
    })

</script>



</body>
</html>